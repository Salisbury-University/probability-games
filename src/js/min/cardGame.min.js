const PLAYER_1=0,PLAYER_2=1,teal=1539721,oceanic=543841,red=14367284,yellow=16762967;var charcoal=13882323;const green=3912003,black=0,white=16777215,Graphics=PIXI.Graphics,Text=PIXI.Text,Sprite=PIXI.Sprite,windowWidth=document.body.clientWidth,windowHeight=window.innerHeight;let audio_pop=new Audio("../sounds/pop.mp3");audio_pop.volume=.5;let audio_roll=new Audio("../sounds/dice_roll.mp3"),audio_woosh=new Audio("../sounds/short_woosh.mp3"),audio_point=new Audio("../sounds/point_2.mp3"),audio_misclick=new Audio("../sounds/wrong.mp3");function loadTheme(){let e=sessionStorage.getItem("theme");console.log("theme from local storage: ",e),"dark"==e&&(document.getElementById("themeTypeSwitch").checked=!0,changeTheme())}window.onload=function(){document.getElementById("volume-control").addEventListener("input",function(e){audio_roll.volume=e.currentTarget.value/100,audio_pop.volume=e.currentTarget.value/100,audio_woosh.volume=e.currentTarget.value/100,audio_point.volume=e.currentTarget.value/100,audio_misclick.volume=e.currentTarget.value/100}),loadTheme()};var cardStyle=new PIXI.TextStyle({dropShadow:!0,dropShadowAlpha:.5,dropShadowDistance:5,fill:16777215,fontFamily:"Comic Sans MS",fontSize:.02*windowWidth,fontWeight:"bolder",lineJoin:"round",strokeThickness:1}),promptStyle=new PIXI.TextStyle({dropShadow:!0,dropShadowAlpha:.5,dropShadowAngle:.5,dropShadowBlur:2,dropShadowColor:"#f9f06b",fontFamily:"Helvetica",fontSize:.02*windowWidth,fontWeight:"bold",fill:14367284}),scoreStyle=new PIXI.TextStyle({fontSize:.03*windowWidth,fontFamily:"Comic Sans MS",fontWeight:"bold",align:"center"});let app=new PIXI.Application({transparent:!0,width:windowWidth,height:.77*windowHeight});document.body.appendChild(app.view);let dice1,dice2,rollButton,promptBackdrop,prompt;var playerTurn=1;class Stack{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){return 0==this.items.length?"Underflow":this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return 0==this.items.length}contains(e){for(let t=0;t<this.items.length;t++)if(this.items[t]==e)return!0;return!1}printStack(){for(var e="",t=0;t<this.items.length;t++)e+=this.items[t]+" ";return e}}function main(){createGame()}function updatePrompt(e,t){0==t?promptStyle.fill=14367284:1==t&&(promptStyle.fill=1539721),prompt.text=e,prompt.x=(windowWidth-prompt.width)/2,promptBackdrop.width=1.02*prompt.width,promptBackdrop.x=prompt.x-.02*prompt.width}app.loader.baseUrl="../images/",app.loader.add("dice0","dice0.png").add("dice1","dice1.png").add("dice2","dice2.png").add("dice3","dice3.png").add("dice4","dice4.png").add("dice5","dice5.png").add("dice6","dice6.png").add("rollButton","rollButton.png"),app.loader.onComplete.add(createGame),app.loader.load();let cardChips1=[],cardChips2=[];var chipStack1=Array(11),chipStack2=Array(11),data=[0,0,0,0,0,0,0,0,0,0,0];let chipsPlaced1=Array(11),chipsPlaced2=Array(11),playerBackgrounds=[];for(let i=0;i<11;i++)chipsPlaced1[i]=0,chipsPlaced2[i]=0;const cardHeight=.23*windowHeight,cardWidth=.07*windowWidth,cornerRadius=6;var chips1=[],chips2=[],cards=[];function createGame(){let e=[],t=[],a=[0,0];createPrompt(),createPlayerScores(e,t,a),createCards(cards,chips1,chips2,e,t,a),createChips(chips1,chips2,e,t,a),createDice(),createRollButton(e,t,a),app.stage.addChild(dice1),app.stage.addChild(dice2)}function createChips(e,t,a,r,o){for(i=0;i<10;i++){let d=i,l=.012*windowWidth,n=.008*windowWidth;e[i]=new Graphics,t[i]=new Graphics,e[i].beginFill(14367284),t[i].beginFill(1539721),e[i].lineStyle(1,0,1),t[i].lineStyle(1,0,1),e[i].drawEllipse(0,0,l,n),t[i].drawEllipse(0,0,l,n),e[i].x=a[0].x+a[0].width/2,t[i].x=a[1].x+a[1].width/2,e[i].y=a[0].y+6*e[0].height-e[0].height/4*i,t[i].y=a[1].y+6*e[0].height-e[0].height/4*i,e[d].interactive=!0,t[d].interactive=!0,e[d].buttonMode=!0,t[d].buttonMode=!0,e[d].on("pointerdown",()=>chipClick(d,0,e,t,a,r,o)),t[d].on("pointerdown",()=>chipClick(d,1,e,t,a,r,o)),e[i].endFill(),t[i].endFill(),app.stage.addChild(e[i]),app.stage.addChild(t[i])}}function createPrompt(){(prompt=new Text("Player 1 click on a card to place your chip",promptStyle)).resolution=2,prompt.x=(windowWidth-prompt.width)/2,prompt.y=.34*windowHeight,(promptBackdrop=new Graphics).beginFill(16762967),promptBackdrop.drawRoundedRect(0,0,1.02*prompt.width,1.02*prompt.height,6),promptBackdrop.x=prompt.x-.01*prompt.width,promptBackdrop.y=prompt.y-.02*prompt.height,promptBackdrop.alpha=.6,promptBackdrop.endFill(),app.stage.addChild(promptBackdrop),app.stage.addChild(prompt)}function createPlayerScores(e,t,a){e[0]=new Text("Player 1's chip stack",{fontSize:.015*windowWidth,fontFamily:'"Arial Black", Gadget, sans-serif',fontWeight:"bold",fill:14367284,align:"center",resolution:2}),e[1]=new Text("Player 2's chip stack",{fontSize:.015*windowWidth,fontFamily:'"Arial Black", Gadget, sans-serif',fontWeight:"bold",fill:1539721,align:"center",resolution:2}),t[0]=new Text("0",scoreStyle),t[1]=new Text("0",scoreStyle),a=[0,0],e[0].x=.05*windowWidth,e[1].x=.95*windowWidth-e[1].width,t[0].x=.05*windowWidth+e[0].width/2,t[1].x=.95*windowWidth-e[1].width/2,e[0].y=.35*windowHeight,e[1].y=.35*windowHeight,t[0].y=.45*windowHeight,t[1].y=.45*windowHeight}function createCards(e,t,a,r,o,d){let l=[],n=[];for(i=0,n[0]=9,n[1]=9,n[2]=20;i<11;i++){let c=i;cardChips1[c]=0,cardChips2[c]=0,chipStack1[c]=new Stack,chipStack2[c]=new Stack,e[i]=new Graphics,e[i].beginFill(16762967),e[i].lineStyle(2,charcoal,4),e[i].drawRoundedRect(0,0,cardWidth,cardHeight,6),e[i].x=windowWidth/11*i+(windowWidth/11-cardWidth)/2,e[i].y=.05*windowHeight,e[i].interactive=!0,e[i].buttonMode=!0,e[i].on("pointerdown",()=>cardClick(e,c,n,t,a,r,o,d)).on("pointerover",()=>hover(e[c],.82)).on("pointerout",()=>hoverOut(e[c])),e[i].endFill(),l[i]=new Text(i+2,cardStyle),l[i].resolution=2,i<8?l[i].x=e[i].x+cardWidth/2*.75:l[i].x=e[i].x+cardWidth/2*.65,l[i].y=.05*windowHeight,app.stage.addChild(e[i]),app.stage.addChild(l[i])}playerBackgrounds[0]=new Graphics,playerBackgrounds[1]=new Graphics,playerBackgrounds[0].beginFill(14367284),playerBackgrounds[0].lineStyle(4,charcoal,4),playerBackgrounds[0].alpha=.2,playerBackgrounds[0].drawRoundedRect(0,0,r[0].width,.3*windowHeight,10),playerBackgrounds[0].x=r[0].x,playerBackgrounds[0].y=r[0].y,playerBackgrounds[1].beginFill(1539721),playerBackgrounds[1].lineStyle(4,charcoal,4),playerBackgrounds[1].alpha=.2,playerBackgrounds[1].drawRoundedRect(0,0,r[1].width,.3*windowHeight,10),playerBackgrounds[1].x=r[1].x,playerBackgrounds[1].y=r[1].y,app.stage.addChild(playerBackgrounds[0]),app.stage.addChild(playerBackgrounds[1]),app.stage.addChild(r[0]),app.stage.addChild(r[1])}function createDice(){dice1=new Sprite.from(app.loader.resources.dice0.texture),dice2=new Sprite.from(app.loader.resources.dice0.texture),dice1.width=.06*windowWidth,dice1.height=.06*windowWidth,dice2.width=.06*windowWidth,dice2.height=.06*windowWidth,dice1.x=windowWidth/2-dice1.width,dice1.y=.47*windowHeight,dice2.x=windowWidth/2,dice2.y=.47*windowHeight}function createRollButton(e,t,a){(rollButton=new Sprite.from(app.loader.resources.rollButton.texture)).width=.1*windowWidth,rollButton.height=.1*windowHeight,rollButton.x=(windowWidth-rollButton.width)/2,rollButton.y=dice1.y+1.15*dice1.height,rollButton.interactive=!0,rollButton.buttonMode=!0,rollButton.on("pointerdown",()=>roll(e,t,a)).on("pointerover",()=>hover(rollButton,.82)).on("pointerout",()=>hoverOut(rollButton))}function switchTurns(e,t,a){1==e?(t[1].alpha=.5,a[1].alpha=.5,t[0].alpha=1,a[0].alpha=1):2==e&&(t[0].alpha=.5,a[0].alpha=.5,t[1].alpha=1,a[1].alpha=1)}function cardClick(e,t,a,r,o,d,l,n){let c=a[0],p=a[1],h=a[2];if(1==playerTurn&&h>0){audio_woosh.pause(),audio_woosh.currentTime=0,audio_woosh.play(),n[0]<10&&n[0]++,l[0].text=n[0];let $=e[t].x+.25*cardWidth,s=e[t].y+cardHeight-cardChips1[t]*(.006*windowWidth),_=($-r[c].x)/20,u=(s-r[c].y)/20,w=0;app.ticker.add(()=>{if(w<20){r[c+1].x+=_,r[c+1].y+=u;for(let t=0;t<11;t++)e[t].interactive=!1;w++}else for(let a=0;a<11;a++)e[a].interactive=!0}),chipStack1[t].push(c),cardChips1[t]+=1,chipsPlaced1[t]+=1,updatePrompt("Player 2 click on a card to place your chip",1),playerTurn=2,switchTurns(2,d,l),c--,a[0]--}else if(2==playerTurn&&h>0){audio_woosh.pause(),audio_woosh.currentTime=0,audio_woosh.play(),n[1]<10&&n[1]++,l[1].text=n[1];let m=e[t].x+.75*cardWidth,g=e[t].y+cardHeight-cardChips2[t]*(.006*windowWidth),y=(m-o[p].x)/20,f=(g-o[p].y)/20,x=0;app.ticker.add(()=>{if(x<20){o[p+1].x+=y,o[p+1].y+=f;for(let t=0;t<11;t++)e[t].interactive=!1;x++}else for(let a=0;a<11;a++)e[a].interactive=!0}),chipStack2[t].push(p),cardChips2[t]+=1,chipsPlaced2[t]+=1,updatePrompt("Player 1 click on a card to place your chip",0),playerTurn=1,switchTurns(1,d,l),p--,a[1]--}if(h--,a[2]--,0==h){for(updatePrompt("Player 1's roll",0),i=0;i<11;i++){let k=i;e[k].interactive=!1,e[k].buttonMode=!1,e[k].on("pointerover",()=>hover(e[k],1))}d[0].text="Player 1's\n Remaining Chips:",d[1].text="Player 2's\n Remaining Chips:",l[0].x=d[0].x+d[0].width/2-l[0].width/2,l[1].x=d[1].x+d[1].width/2-l[1].width/2,playerBackgrounds[0].width=d[0].width+4,playerBackgrounds[1].width=d[1].width+4,d[0].x=playerBackgrounds[0].x,d[1].x=playerBackgrounds[1].x,app.stage.addChild(l[0]),app.stage.addChild(l[1]),app.stage.addChild(rollButton)}}function hover(e,t){e.alpha=t}function hoverOut(e){e.alpha=1}var numRolls=[,,];numRolls[0]=0,numRolls[1]=0;var clickableCard=-1;function roll(e,t,a){audio_roll.pause(),audio_roll.currentTime=0,audio_roll.play(),dice1.interactive=!0,dice2.interactive=!0;let r=0,o=1,d=1;app.ticker.add(()=>{if(r%5==0&&r<50)o=Math.floor(6*Math.random())+1,d=Math.floor(6*Math.random())+1,dice1.texture=app.loader.resources[`dice${o}`].texture,dice2.texture=app.loader.resources[`dice${d}`].texture,rollButton.interactive=!1;else if(50==r){data[o+d-2]++,updateChart();let l=o+d;1==playerTurn?(numRolls[0]+=1,cardChips1[l-2]>0?(rollButton.interactive=!1,updatePrompt("click on the correct pile to remove the chip",0),clickableCard=l-2):(updatePrompt("Player 2's roll",1),playerTurn=2,switchTurns(2,e,t),rollButton.interactive=!0)):(numRolls[1]+=1,cardChips2[l-2]>0?(rollButton.interactive=!1,updatePrompt("click on the correct pile to remove the chip",1),clickableCard=l-2):(updatePrompt("Player 1's roll",0),playerTurn=1,switchTurns(1,e,t),rollButton.interactive=!0)),r++}if(r++,0==a[0]||0==a[1]){rollButton.interactive=!1,app.stage.removeChild(dice1),app.stage.removeChild(dice2),app.stage.removeChild(prompt),app.stage.removeChild(rollButton),0==a[0]?(winStr=`Player 1 won in ${numRolls[0]} rolls!`,document.getElementById("win-header").style.color="#db3a34"):0==a[1]&&(winStr=`Player 2 won in ${numRolls[1]} rolls!`,document.getElementById("win-header").style.color="#177e89"),a[0]=-1,a[1]=-1,app.height=1;for(let n=app.stage.children.length-1;n>=0;n--)app.stage.removeChild(app.stage.children[n]);document.getElementById("win-header").innerHTML=winStr;for(let c=0;c<11;c++){let p=c;document.getElementById(`r1c${p+1}`).innerHTML=chipsPlaced1[p],document.getElementById(`r2c${p+1}`).innerHTML=chipsPlaced2[p]}document.body.removeChild(app.view),document.getElementById("border").hidden=!1,document.getElementById("resetButton").hidden=!0}})}function playAgain(){location.reload()}function chipClick(e,t,a,r,o,d,l){-1!=clickableCard&&(1==playerTurn&&playerTurn==t+1?chipStack1[clickableCard].contains(e)?(audio_pop.play(),app.stage.removeChild(a[chipStack1[clickableCard].pop()]),l[0]-=1,cardChips1[clickableCard]-=1,d[0].text=l[0],d[0].x=o[0].x+o[0].width/2-d[0].width/2,rollButton.interactive=!0,updatePrompt("Player 2's roll",1),playerTurn=2,switchTurns(2,o,d),clickableCard=-1):(audio_misclick.pause(),audio_misclick.time=0,audio_misclick.play()):2==playerTurn&&playerTurn==t+1&&chipStack2[clickableCard].contains(e)?(audio_pop.play(),app.stage.removeChild(r[chipStack2[clickableCard].pop()]),l[1]-=1,cardChips2[clickableCard]-=1,d[1].text=l[1],d[1].x=o[1].x+o[1].width/2-d[1].width/2,rollButton.interactive=!0,updatePrompt("Player 1's roll",0),playerTurn=1,switchTurns(1,o,d),clickableCard=-1):(audio_misclick.pause(),audio_misclick.time=0,audio_misclick.play()))}function changeTheme(){document.getElementById("themeTypeSwitch").checked?document.getElementById("themeTypeSwitch").checked&&(document.body.style.backgroundColor="#434445",document.querySelectorAll(".themeable").forEach(e=>e.classList.add("text-white")),document.querySelectorAll(".modal-content, .list-group-item").forEach(e=>e.classList.add("bg-dark")),updateChart(),sessionStorage.setItem("theme","dark")):(document.body.style.backgroundColor="#ffffff",document.querySelectorAll(".themeable").forEach(e=>e.classList.remove("text-white")),document.querySelectorAll(".modal-content").forEach(e=>e.classList.remove("bg-dark")),updateChart(),sessionStorage.setItem("theme","light"))}function updateChart(){let e={top:20,right:20,bottom:30,left:40},t=900-e.left-e.right,a=400-e.top-e.bottom,r=d3.select("svg");r.selectAll("*").remove();let o=r.append("g").attr("transform",`translate(${e.left}, ${e.top})`),d=d3.scaleBand().domain(data.map((e,t)=>t+2)).range([0,t]).padding(.1),l=d3.max(data),n=d3.scaleLinear().domain([0,l>0?l:1]).range([a,0]),c=d3.axisBottom(d),p=d3.axisLeft(n);o.append("g").attr("transform",`translate(0, ${a})`).call(c),o.append("g").call(p),o.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("x",(e,t)=>d(t+2)).attr("y",e=>n(e)).attr("width",d.bandwidth()).attr("height",e=>a-n(e)),o.append("text").attr("class","x label").attr("text-anchor","middle").attr("x",t/2).attr("y",a+e.bottom).text("Dice Sum"),o.append("text").attr("class","y label").attr("text-anchor","middle").attr("x",-a/2).attr("y",-e.left+15).attr("transform","rotate(-90)").text("Number of Hits"),document.getElementById("themeTypeSwitch").checked?o.selectAll("text").attr("fill","#ffffff"):o.selectAll("text").attr("fill","#000000")}updateChart();